<div class="usuario-form-page">
  <h1 *ngIf="!esEdicion">Nuevo Usuario</h1>
  <h1 *ngIf="esEdicion">Editar Usuario</h1>

  <div *ngIf="cargando" class="info">Cargando datos...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" *ngIf="!cargando">
    <div class="form-grid">
      <div class="form-group">
        <label>Cliente ID (opcional)</label>
        <input formControlName="cliente_id" type="text" />
      </div>

      <div class="form-group">
        <label>Username</label>
        <input formControlName="username" type="text" />
        <div class="errores" *ngIf="form.get('username')?.touched">
          <small *ngIf="tieneError('username', 'required')">
            El username es obligatorio.
          </small>
          <small *ngIf="tieneError('username', 'maxlength')">
            Máximo 50 caracteres.
          </small>
        </div>
      </div>

      <div class="form-group">
        <label>Rol ID</label>
        <input formControlName="rol_id" type="text" />
        <div class="errores" *ngIf="form.get('rol_id')?.touched">
          <small *ngIf="tieneError('rol_id', 'required')">
            El rol es obligatorio.
          </small>
          <small *ngIf="tieneError('rol_id', 'maxlength')">
            Máximo 36 caracteres.
          </small>
        </div>
        <small class="hint"
          >Pegá aquí el UUID del rol (administrador, cajero, etc.).</small
        >
      </div>

      <div class="form-group">
        <label>Estado</label>
        <select formControlName="estado">
          <option *ngFor="let e of estados" [value]="e">
            {{ e }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Intentos fallidos</label>
        <input formControlName="intentos_fallidos" type="number" min="0" />
        <div
          class="errores"
          *ngIf="form.get('intentos_fallidos')?.touched"
        >
          <small *ngIf="tieneError('intentos_fallidos', 'required')">
            Este campo es obligatorio.
          </small>
          <small *ngIf="tieneError('intentos_fallidos', 'min')">
            No puede ser negativo.
          </small>
        </div>
      </div>

      <div class="form-group full">
        <label>
          {{ esEdicion ? 'Nueva contraseña (opcional)' : 'Contraseña' }}
        </label>
        <input formControlName="password" type="password" />
        <div class="errores" *ngIf="form.get('password')?.touched">
          <small *ngIf="tieneError('password', 'required') && !esEdicion">
            La contraseña es obligatoria.
          </small>
          <small *ngIf="tieneError('password', 'minlength')">
            Mínimo 4 caracteres.
          </small>
        </div>
        <small class="hint">
          Por ahora se guarda tal cual (solo pruebas). Más adelante se puede
          hashear con bcrypt.
        </small>
      </div>
    </div>

    <div class="acciones">
      <button type="button" class="btn-cancelar" (click)="cancelar()">
        Cancelar
      </button>

      <button type="submit" class="btn-guardar" [disabled]="guardando">
        {{ guardando ? 'Guardando...' : 'Guardar' }}
      </button>
    </div>
  </form>
</div>
